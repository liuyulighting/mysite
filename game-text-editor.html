<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏仪表板文本编辑器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
        }

        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .language-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-header.zh { background: #e74c3c; }
        .panel-header.en { background: #3498db; }
        .panel-header.ja { background: #9b59b6; }

        .panel-content {
            padding: 20px;
            max-height: 700px;
            overflow-y: auto;
        }

        .text-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .text-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .text-item {
            margin-bottom: 15px;
        }

        .text-item:last-child {
            margin-bottom: 0;
        }

        .text-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .text-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .text-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .text-input.textarea {
            min-height: 80px;
            resize: vertical;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .preview {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .preview h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .preview-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .section-icon {
            font-size: 18px;
        }

        .key-path {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #6c757d;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .editor-layout {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 游戏仪表板文本编辑器</h1>
            <p>专门用于管理游戏仪表板界面中的所有文本内容，支持多语言编辑</p>
        </div>

        <div id="status"></div>

        <div class="editor-layout" id="editorLayout">
            <!-- 编辑器面板将在这里动态生成 -->
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="saveAll()">💾 保存所有文件</button>
            <button class="btn btn-success" onclick="addNewText()">➕ 添加新文本</button>
            <button class="btn btn-warning" onclick="validateJSON()">✅ 验证JSON</button>
            <button class="btn btn-secondary" onclick="resetChanges()">🔄 重置更改</button>
            <button class="btn btn-secondary" onclick="showPreview()">👁️ 预览JSON</button>
        </div>

        <div class="preview" id="preview" style="display: none;">
            <h3>📋 JSON 预览</h3>
            <div class="preview-content" id="previewContent"></div>
        </div>
    </div>

    <script>
        let currentData = {
            zh: {},
            en: {},
            ja: {}
        };
        let originalData = {};

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadGameDashboardData();
        });

        // 加载游戏仪表板数据
        async function loadGameDashboardData() {
            showStatus('正在加载游戏仪表板数据...', 'info');
            
            try {
                // 从profile.json加载数据
                const response = await fetch('data/profile.json');
                if (response.ok) {
                    const profileData = await response.json();
                    currentData = convertProfileToGameText(profileData);
                } else {
                    // 如果文件不存在，使用默认数据
                    currentData = getDefaultGameText();
                }
                
                originalData = JSON.parse(JSON.stringify(currentData));
                renderEditor();
                showStatus('游戏仪表板数据加载成功！', 'success');
            } catch (error) {
                showStatus('加载数据失败：' + error.message, 'error');
                // 使用默认数据
                currentData = getDefaultGameText();
                originalData = JSON.parse(JSON.stringify(currentData));
                renderEditor();
            }
        }

        // 将profile数据转换为游戏文本格式
        function convertProfileToGameText(profileData) {
            const result = { zh: {}, en: {}, ja: {} };
            
            // 基本信息
            result.zh.profile = {
                name: profileData.profile?.nameZh || profileData.profile?.name || "刘禹",
                title: profileData.profile?.titleZh || profileData.profile?.title || "产品经理",
                location: profileData.profile?.locationZh || profileData.profile?.location || "中国南京",
                email: profileData.profile?.email || "liuyulighting@gmail.com",
                phone: profileData.profile?.phone || "+86 18069860189"
            };
            
            result.en.profile = {
                name: profileData.profile?.name || "Yu Liu",
                title: profileData.profile?.title || "Product Manager",
                location: profileData.profile?.location || "Nanjing, China",
                email: profileData.profile?.email || "liuyulighting@gmail.com",
                phone: profileData.profile?.phone || "+86 18069860189"
            };
            
            result.ja.profile = {
                name: profileData.profile?.name || "Yu Liu",
                title: "プロダクトマネージャー",
                location: "中国 南京",
                email: profileData.profile?.email || "liuyulighting@gmail.com",
                phone: profileData.profile?.phone || "+86 18069860189"
            };

            // 卡带信息
            result.zh.cartridges = {
                d5: "D5 渲染器",
                kujiale: "酷家乐",
                projects: "个人项目"
            };
            
            result.en.cartridges = {
                d5: "D5 Render",
                kujiale: "Kujiale",
                projects: "Side Projects"
            };
            
            result.ja.cartridges = {
                d5: "D5 レンダー",
                kujiale: "クージャレ",
                projects: "サイドプロジェクト"
            };

            // 标签页
            result.zh.tabs = {
                skills: "技能",
                achievements: "成就",
                education: "教育"
            };
            
            result.en.tabs = {
                skills: "Skills",
                achievements: "Achievements",
                education: "Education"
            };
            
            result.ja.tabs = {
                skills: "スキル",
                achievements: "実績",
                education: "教育"
            };

            // 项目轮播
            result.zh.projects = {
                d5Title: "D5 渲染器团队版",
                d5Desc: "全球领先的即时渲染器 B 端版本，ARR 超 1500 万",
                kujialeTitle: "前后端一体对接生产方案",
                kujialeDesc: "门店订单直连工厂审核与生产，支撑 100 亿资产流转",
                officeTitle: "公装参数化设计工具",
                officeDesc: "参数化装配式办公家具设计，服务震旦/圣奥等品牌",
                diverseshotTitle: "DiverseShot AI",
                diverseshotDesc: "将视频转换为 3D 文件的 AI 客户端，简单易用"
            };
            
            result.en.projects = {
                d5Title: "D5 Render Team Edition",
                d5Desc: "Leading real-time renderer B2B version with ARR over 15M RMB",
                kujialeTitle: "End-to-End Production Solution",
                kujialeDesc: "Store orders directly connect to factory review and production, supporting 10B asset flow",
                officeTitle: "Parametric Office Design Tool",
                officeDesc: "Parametric modular office furniture design, serving Aurora/Sunon brands",
                diverseshotTitle: "DiverseShot AI",
                diverseshotDesc: "AI client that converts videos to 3D files, simple and easy to use"
            };
            
            result.ja.projects = {
                d5Title: "D5 レンダーチーム版",
                d5Desc: "世界トップクラスのリアルタイムレンダラーB2B版、ARR 1500万超",
                kujialeTitle: "フロントエンド・バックエンド一体生産ソリューション",
                kujialeDesc: "店舗注文が工場審査・生産に直接接続、100億資産流転をサポート",
                officeTitle: "オフィスパラメトリックデザインツール",
                officeDesc: "パラメトリック組立式オフィス家具デザイン、震旦/圣奥ブランドにサービス",
                diverseshotTitle: "DiverseShot AI",
                diverseshotDesc: "動画を3Dファイルに変換するAIクライアント、シンプルで使いやすい"
            };

            // 按钮和界面文本
            result.zh.ui = {
                start: "START",
                exit: "EXIT",
                welcome: "欢迎来到我的作品集",
                welcomeDesc: "点击 START 按钮开始探索我的作品",
                cartridge: "卡带",
                level: "关卡",
                cards: "卡片"
            };
            
            result.en.ui = {
                start: "START",
                exit: "EXIT",
                welcome: "Welcome to My Portfolio",
                welcomeDesc: "Click START button to explore my works",
                cartridge: "Cartridge",
                level: "Level",
                cards: "Cards"
            };
            
            result.ja.ui = {
                start: "スタート",
                exit: "終了",
                welcome: "私のポートフォリオへようこそ",
                welcomeDesc: "スタートボタンをクリックして私の作品を探索してください",
                cartridge: "カートリッジ",
                level: "レベル",
                cards: "カード"
            };

            return result;
        }

        // 获取默认游戏文本
        function getDefaultGameText() {
            return {
                zh: {
                    profile: {
                        name: "刘禹",
                        title: "产品经理",
                        location: "中国南京",
                        email: "liuyulighting@gmail.com",
                        phone: "+86 18069860189"
                    },
                    cartridges: {
                        d5: "D5 渲染器",
                        kujiale: "酷家乐",
                        projects: "个人项目"
                    },
                    tabs: {
                        skills: "技能",
                        achievements: "成就",
                        education: "教育"
                    },
                    projects: {
                        d5Title: "D5 渲染器团队版",
                        d5Desc: "全球领先的即时渲染器 B 端版本，ARR 超 1500 万",
                        kujialeTitle: "前后端一体对接生产方案",
                        kujialeDesc: "门店订单直连工厂审核与生产，支撑 100 亿资产流转",
                        officeTitle: "公装参数化设计工具",
                        officeDesc: "参数化装配式办公家具设计，服务震旦/圣奥等品牌",
                        diverseshotTitle: "DiverseShot AI",
                        diverseshotDesc: "将视频转换为 3D 文件的 AI 客户端，简单易用"
                    },
                    ui: {
                        start: "START",
                        exit: "EXIT",
                        welcome: "欢迎来到我的作品集",
                        welcomeDesc: "点击 START 按钮开始探索我的作品",
                        cartridge: "卡带",
                        level: "关卡",
                        cards: "卡片"
                    }
                },
                en: {
                    profile: {
                        name: "Yu Liu",
                        title: "Product Manager",
                        location: "Nanjing, China",
                        email: "liuyulighting@gmail.com",
                        phone: "+86 18069860189"
                    },
                    cartridges: {
                        d5: "D5 Render",
                        kujiale: "Kujiale",
                        projects: "Side Projects"
                    },
                    tabs: {
                        skills: "Skills",
                        achievements: "Achievements",
                        education: "Education"
                    },
                    projects: {
                        d5Title: "D5 Render Team Edition",
                        d5Desc: "Leading real-time renderer B2B version with ARR over 15M RMB",
                        kujialeTitle: "End-to-End Production Solution",
                        kujialeDesc: "Store orders directly connect to factory review and production, supporting 10B asset flow",
                        officeTitle: "Parametric Office Design Tool",
                        officeDesc: "Parametric modular office furniture design, serving Aurora/Sunon brands",
                        diverseshotTitle: "DiverseShot AI",
                        diverseshotDesc: "AI client that converts videos to 3D files, simple and easy to use"
                    },
                    ui: {
                        start: "START",
                        exit: "EXIT",
                        welcome: "Welcome to My Portfolio",
                        welcomeDesc: "Click START button to explore my works",
                        cartridge: "Cartridge",
                        level: "Level",
                        cards: "Cards"
                    }
                },
                ja: {
                    profile: {
                        name: "Yu Liu",
                        title: "プロダクトマネージャー",
                        location: "中国 南京",
                        email: "liuyulighting@gmail.com",
                        phone: "+86 18069860189"
                    },
                    cartridges: {
                        d5: "D5 レンダー",
                        kujiale: "クージャレ",
                        projects: "サイドプロジェクト"
                    },
                    tabs: {
                        skills: "スキル",
                        achievements: "実績",
                        education: "教育"
                    },
                    projects: {
                        d5Title: "D5 レンダーチーム版",
                        d5Desc: "世界トップクラスのリアルタイムレンダラーB2B版、ARR 1500万超",
                        kujialeTitle: "フロントエンド・バックエンド一体生産ソリューション",
                        kujialeDesc: "店舗注文が工場審査・生産に直接接続、100億資産流転をサポート",
                        officeTitle: "オフィスパラメトリックデザインツール",
                        officeDesc: "パラメトリック組立式オフィス家具デザイン、震旦/圣奥ブランドにサービス",
                        diverseshotTitle: "DiverseShot AI",
                        diverseshotDesc: "動画を3Dファイルに変換するAIクライアント、シンプルで使いやすい"
                    },
                    ui: {
                        start: "スタート",
                        exit: "終了",
                        welcome: "私のポートフォリオへようこそ",
                        welcomeDesc: "スタートボタンをクリックして私の作品を探索してください",
                        cartridge: "カートリッジ",
                        level: "レベル",
                        cards: "カード"
                    }
                }
            };
        }

        // 渲染编辑器
        function renderEditor() {
            const layout = document.getElementById('editorLayout');
            layout.innerHTML = '';
            
            const languages = [
                { code: 'zh', name: '中文', flag: '🇨🇳' },
                { code: 'en', name: 'English', flag: '🇺🇸' },
                { code: 'ja', name: '日本語', flag: '🇯🇵' }
            ];
            
            languages.forEach(lang => {
                const panel = createLanguagePanel(lang);
                layout.appendChild(panel);
            });
        }

        // 创建语言面板
        function createLanguagePanel(lang) {
            const panel = document.createElement('div');
            panel.className = 'language-panel';
            
            const header = document.createElement('div');
            header.className = `panel-header ${lang.code}`;
            header.innerHTML = `${lang.flag} ${lang.name}`;
            
            const content = document.createElement('div');
            content.className = 'panel-content';
            content.innerHTML = renderLanguageContent(lang.code);
            
            panel.appendChild(header);
            panel.appendChild(content);
            
            return panel;
        }

        // 渲染语言内容
        function renderLanguageContent(langCode) {
            const data = currentData[langCode] || {};
            let html = '';
            
            // 定义文本分组和图标
            const sections = [
                { key: 'profile', name: '个人信息', icon: '👤' },
                { key: 'cartridges', name: '游戏卡带', icon: '🎮' },
                { key: 'tabs', name: '标签页', icon: '📑' },
                { key: 'projects', name: '项目轮播', icon: '🎯' },
                { key: 'ui', name: '界面文本', icon: '🖥️' }
            ];
            
            sections.forEach(section => {
                if (data[section.key]) {
                    html += `<div class="text-section">
                        <h3><span class="section-icon">${section.icon}</span> ${section.name}</h3>`;
                    
                    Object.keys(data[section.key]).forEach(key => {
                        const value = data[section.key][key];
                        const inputId = `${langCode}_${section.key}_${key}`;
                        const keyPath = `${section.key}.${key}`;
                        
                        html += `<div class="text-item">
                            <div class="text-label">
                                <span class="key-path">${keyPath}</span>
                            </div>
                            <input type="text" 
                                   id="${inputId}" 
                                   class="text-input ${key.includes('Desc') ? 'textarea' : ''}" 
                                   value="${escapeHtml(value)}"
                                   onchange="updateText('${langCode}', '${section.key}', '${key}', this.value)">
                        </div>`;
                    });
                    
                    html += '</div>';
                }
            });
            
            return html;
        }

        // 更新文本
        function updateText(langCode, section, key, value) {
            if (!currentData[langCode]) {
                currentData[langCode] = {};
            }
            if (!currentData[langCode][section]) {
                currentData[langCode][section] = {};
            }
            currentData[langCode][section][key] = value;
        }

        // 保存所有文件
        async function saveAll() {
            showStatus('正在保存文件...', 'info');
            
            try {
                // 将游戏文本数据转换回profile.json格式
                const profileData = await convertGameTextToProfile(currentData);
                
                // 尝试通过API保存文件
                try {
                    const response = await fetch('http://localhost:8081/api/save', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(profileData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showStatus('✅ 文件保存成功！', 'success');
                        originalData = JSON.parse(JSON.stringify(currentData));
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (apiError) {
                    // API保存失败，提供下载选项
                    console.warn('API保存失败，提供下载选项:', apiError);
                    downloadProfileJSON(profileData);
                    showStatus('⚠️ API保存失败，已提供下载选项', 'warning');
                }
                
            } catch (error) {
                showStatus('保存失败：' + error.message, 'error');
            }
        }
        
        // 下载profile.json文件
        function downloadProfileJSON(data) {
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'profile.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('📥 已提供profile.json下载，请手动替换data/profile.json文件', 'info');
        }

        // 将游戏文本数据转换回profile格式
        function convertGameTextToProfile(gameTextData) {
            // 首先加载原始profile.json以保持完整结构
            return new Promise((resolve, reject) => {
                fetch('data/profile.json')
                    .then(response => response.json())
                    .then(originalProfile => {
                        // 更新profile部分
                        if (gameTextData.zh && gameTextData.zh.profile) {
                            Object.keys(gameTextData.zh.profile).forEach(key => {
                                if (originalProfile.profile[key + 'Zh']) {
                                    originalProfile.profile[key + 'Zh'] = gameTextData.zh.profile[key];
                                }
                            });
                        }
                        if (gameTextData.en && gameTextData.en.profile) {
                            Object.keys(gameTextData.en.profile).forEach(key => {
                                if (originalProfile.profile[key]) {
                                    originalProfile.profile[key] = gameTextData.en.profile[key];
                                }
                            });
                        }
                        if (gameTextData.ja && gameTextData.ja.profile) {
                            Object.keys(gameTextData.ja.profile).forEach(key => {
                                if (originalProfile.profile[key + 'Ja']) {
                                    originalProfile.profile[key + 'Ja'] = gameTextData.ja.profile[key];
                                }
                            });
                        }
                        
                        // 更新cartridges部分
                        if (gameTextData.zh && gameTextData.zh.cartridges) {
                            originalProfile.cartridges.forEach(cartridge => {
                                if (gameTextData.zh.cartridges[cartridge.id]) {
                                    cartridge.nameZh = gameTextData.zh.cartridges[cartridge.id];
                                }
                            });
                        }
                        if (gameTextData.en && gameTextData.en.cartridges) {
                            originalProfile.cartridges.forEach(cartridge => {
                                if (gameTextData.en.cartridges[cartridge.id]) {
                                    cartridge.name = gameTextData.en.cartridges[cartridge.id];
                                }
                            });
                        }
                        if (gameTextData.ja && gameTextData.ja.cartridges) {
                            originalProfile.cartridges.forEach(cartridge => {
                                if (gameTextData.ja.cartridges[cartridge.id]) {
                                    cartridge.nameJa = gameTextData.ja.cartridges[cartridge.id];
                                }
                            });
                        }
                        
                        // 更新UI部分
                        if (gameTextData.zh && gameTextData.zh.ui) {
                            if (!originalProfile.ui) originalProfile.ui = {};
                            Object.keys(gameTextData.zh.ui).forEach(key => {
                                if (!originalProfile.ui[key]) originalProfile.ui[key] = {};
                                originalProfile.ui[key].zh = gameTextData.zh.ui[key];
                            });
                        }
                        if (gameTextData.en && gameTextData.en.ui) {
                            if (!originalProfile.ui) originalProfile.ui = {};
                            Object.keys(gameTextData.en.ui).forEach(key => {
                                if (!originalProfile.ui[key]) originalProfile.ui[key] = {};
                                originalProfile.ui[key].en = gameTextData.en.ui[key];
                            });
                        }
                        if (gameTextData.ja && gameTextData.ja.ui) {
                            if (!originalProfile.ui) originalProfile.ui = {};
                            Object.keys(gameTextData.ja.ui).forEach(key => {
                                if (!originalProfile.ui[key]) originalProfile.ui[key] = {};
                                originalProfile.ui[key].ja = gameTextData.ja.ui[key];
                            });
                        }
                        
                        resolve(originalProfile);
                    })
                    .catch(error => {
                        console.error('加载原始profile.json失败:', error);
                        reject(error);
                    });
            });
        }

        // 添加新文本
        function addNewText() {
            const section = prompt('请输入新的分组名称（如：profile, cartridges, tabs, projects, ui）：');
            if (!section) return;
            
            const key = prompt('请输入新的键名：');
            if (!key) return;
            
            const languages = ['zh', 'en', 'ja'];
            languages.forEach(lang => {
                const value = prompt(`请输入${lang}的文本内容：`);
                if (value) {
                    if (!currentData[lang]) {
                        currentData[lang] = {};
                    }
                    if (!currentData[lang][section]) {
                        currentData[lang][section] = {};
                    }
                    currentData[lang][section][key] = value;
                }
            });
            
            renderEditor();
            showStatus('新文本添加成功！', 'success');
        }

        // 验证JSON
        function validateJSON() {
            const languages = ['zh', 'en', 'ja'];
            let isValid = true;
            let errors = [];
            
            languages.forEach(lang => {
                try {
                    JSON.stringify(currentData[lang]);
                } catch (error) {
                    isValid = false;
                    errors.push(`${lang}: ${error.message}`);
                }
            });
            
            if (isValid) {
                showStatus('✅ JSON格式验证通过！', 'success');
            } else {
                showStatus('❌ JSON格式错误：' + errors.join(', '), 'error');
            }
        }

        // 重置更改
        function resetChanges() {
            if (confirm('确定要重置所有更改吗？')) {
                currentData = JSON.parse(JSON.stringify(originalData));
                renderEditor();
                showStatus('更改已重置', 'info');
            }
        }

        // 显示状态
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            setTimeout(() => {
                status.innerHTML = '';
            }, 5000);
        }

        // 转义HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 显示预览
        function showPreview() {
            const preview = document.getElementById('preview');
            const content = document.getElementById('previewContent');
            
            let previewText = '';
            Object.keys(currentData).forEach(lang => {
                previewText += `// ${lang} 游戏文本数据\n`;
                previewText += JSON.stringify(currentData[lang], null, 2);
                previewText += '\n\n';
            });
            
            content.textContent = previewText;
            preview.style.display = 'block';
        }
    </script>
</body>
</html>
